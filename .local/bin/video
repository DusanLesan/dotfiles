#!/bin/sh

pkill mpv
mdir="$(dirname $(readlink -f "$1"))"

for file in "$mdir"/*; do
	if [[ $file =~ @*.(ass|srt|sub) ]]; then
		[ -n "$subs" ] && subs="$subs:$file" || subs="$file"
	fi
done

paths=()
for arg; do
	IFS=$'\n' read -rd '' -a lines <<<"$arg"; paths+=("${lines[@]}");
done

cmd=mpv
[[ -n $subs ]] && cmd="$cmd --sub-files=$subs"
! printf '%s\0' "$@" | grep -qz ';' && cmd="devour $cmd" # devour cannot handle semicolons

$cmd "${paths[@]}"

exit 0
