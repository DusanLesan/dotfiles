#!/bin/sh

sendCommand() {
	playerctl $*
	kill -44 $(pidof dwmblocks)
}

showInfo() {
	while read -r player; do
		status=$(playerctl --player="$player" status)
		[ "$status" = "Paused" ] && info=' '
		[ "$status" != "Playing" ] && continue
		[[ $player == *"instance"* ]] && format="{{title}}" || format="{{artist}} - {{title}}"
		info="$(playerctl --player="$player" metadata --format "$format")" && break
	done <<< "$(playerctl --list-all)"

	echo "$info"
}

case $BLOCK_BUTTON in
	1) sendCommand play-pause ;;
	3) showInfo; sendCommand --player="$player" stop ;;
	4) sendCommand previous ;;
	5) sendCommand next ;;
esac

showInfo
